{% extends 'tienda/base.html' %}

{% block content %}
<section class="section checkout-section">
    <div class="container">
        <h1 class="section-title">Finalizar Compra</h1>

        <div class="checkout-grid">
            <!-- Columna Izquierda: Formulario -->
            <div class="checkout-form-column">
                <div class="checkout-card">
                    <div class="checkout-card-header">
                        <h3><span class="step-number">1</span> Informaci√≥n de Contacto</h3>
                        <p>Completa tus datos para coordinar el retiro y pago en el local.</p>
                    </div>
                    <div class="checkout-card-body">
                        <form method="post" class="modern-form">
                            {% csrf_token %}
                            {% for field in form %}
                            <div class="form-group mb-4">
                                <div class="floating-label-group">
                                    <div class="field-icon-wrapper">
                                        {% if field.name == 'nombre' %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" class="field-icon">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        {% elif field.name == 'email' %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" class="field-icon">
                                            <path
                                                d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z">
                                            </path>
                                            <polyline points="22,6 12,13 2,6"></polyline>
                                        </svg>
                                        {% elif field.name == 'telefono' %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" class="field-icon">
                                            <path
                                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                                            </path>
                                        </svg>
                                        {% endif %}
                                        {{ field }}
                                        <label for="{{ field.id_for_label }}"
                                            class="form-label-custom-floating">{{field.label }}</label>
                                    </div>
                                </div>
                                {% if field.errors %}
                                <div class="form-error">
                                    {{ field.errors }}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}

                            <div class="checkout-actions">
                                <button type="submit" class="btn btn-confirm-order btn-lg w-100">
                                    Confirmar Pedido üé£
                                </button>
                                <p class="checkout-note">
                                    <small>Al confirmar, prepararemos tu pedido para que lo retires por nuestro
                                        local.</small>
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Columna Derecha: Resumen -->
            <div class="checkout-summary-column">
                <div class="checkout-summary-card">
                    <h3>Resumen del Pedido</h3>
                    <div class="summary-items">
                        {% for item in carrito %}
                        <div class="summary-item">
                            <div class="item-info">
                                <span class="item-name">{{ item.producto.nombre }}</span>
                                <span class="item-quantity">Cant: {{ item.cantidad }}</span>
                            </div>
                            <span class="item-price">${{ item.total_precio }}</span>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-total">
                        <span>Total a pagar en local</span>
                        <span class="total-amount">${{ carrito.get_total_price }}</span>
                    </div>

                    <div class="summary-footer">
                        <div class="payment-method">
                            <span class="method-icon">üìç</span>
                            <div class="method-details">
                                <strong>Retiro en Local</strong>
                                <small>Paga al recibir tus productos</small>
                            </div>
                        </div>
                    </div>
                </div>

                <a href="{% url 'tienda:ver_carrito' %}" class="back-to-cart">
                    ‚Üê Volver al carrito
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}
